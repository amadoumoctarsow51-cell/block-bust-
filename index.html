<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Block Blast Pro</title>
<style>
:root{
  --card-bg:#4b6bd6;
  --panel-bg:#2b3450;
  --accent:#ffd24d;
  --tile-size:36px;
}
*{box-sizing:border-box;font-family:Inter,'Segoe UI',Roboto,Arial,sans-serif;}
html,body{margin:0;height:100%;background:#000;overflow:hidden;}
#bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;}

.stage{
  width:90%;max-width:420px;margin:28px auto;padding:18px;border-radius:36px;
  background:linear-gradient(180deg,var(--card-bg),#5977d6);
  color:#fff;position:relative;box-shadow:0 10px 30px rgba(0,0,0,.6);z-index:1;
}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.score{font-size:48px;font-weight:700;text-align:center;flex:1;transition:transform .2s;}
.score.animate{transform:scale(1.3);}
.crown{display:flex;align-items:center;gap:8px;color:var(--accent);font-weight:700}

.board-wrap{background:var(--panel-bg);padding:16px;border-radius:12px;display:flex;flex-direction:column;align-items:center;}
.grid{width:100%;max-width:360px;aspect-ratio:1/1;background:rgba(0,0,0,0.15);
display:grid;grid-template-columns:repeat(10,1fr);grid-template-rows:repeat(10,1fr);gap:4px;padding:8px;border-radius:6px;position:relative;}
.cell{background:rgba(255,255,255,0.02);border-radius:4px;display:flex;align-items:center;justify-content:center;transition:background .2s;}
.tile{width:100%;height:100%;border-radius:4px;box-shadow:inset -4px -4px 0 rgba(0,0,0,.12);transition:transform .2s,opacity .2s;}

.controls{display:flex;justify-content:space-around;align-items:center;margin-top:18px;width:100%;}
.piece-slot{width:30%;aspect-ratio:1.3/1;border-radius:12px;background:rgba(255,255,255,0.06);
display:flex;align-items:center;justify-content:center;padding:4px;position:relative;}
.piece{display:grid;gap:4px;cursor:grab;touch-action:none;user-select:none;transition:transform .2s;}
.piece.dragging{opacity:0.8;transform:scale(1.1);z-index:1000;}

.btn{margin-top:12px;padding:8px 12px;border-radius:12px;background:rgba(0,0,0,0.2);border:0;color:#fff;cursor:pointer;flex:1;transition:background .2s;}
.btn:hover{background:rgba(0,0,0,0.35);}

.c-1{background:#ffd54d}
.c-2{background:#39d353}
.c-3{background:#6ec7ff}
.c-4{background:#a06bff}
.c-5{background:#ff6b6b}
.c-6{background:#3b82f6}

/* Secret Message */
.secret{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
  opacity:0;pointer-events:none;transition:opacity 0.4s ease;
  z-index:10;
}
.secret.show{opacity:1;pointer-events:auto;}
.secret-card{
  background: linear-gradient(135deg, rgba(255,240,245,0.95), rgba(255,230,250,0.95));
  color:#111;
  padding:32px 28px;
  border-radius:40px;
  max-width:500px;
  width:90%;
  text-align:left;
  box-shadow:0 25px 60px rgba(0,0,0,0.35);
  transform:scale(0.5);
  opacity:0;
  font-size:20px;
  line-height:1.8;
  font-family:'Segoe UI','Inter',sans-serif;
  transition: transform 0.6s cubic-bezier(0.68,-0.55,0.27,1.55),opacity 0.6s ease;
  max-height:80vh; overflow-y:auto; padding-right:12px;
}
.secret-card.show{
  transform:scale(1);
  opacity:1;
  animation:pulse 1.2s ease infinite alternate;
}
@keyframes pulse{
  0%{box-shadow:0 25px 60px rgba(0,0,0,0.3);}
  100%{box-shadow:0 30px 75px rgba(0,0,0,0.5);}
}

/* Confetti */
.confetti{
  position:absolute;width:8px;height:8px;border-radius:50%;pointer-events:none;
  opacity:0.9;
  animation:confetti-fall linear infinite;
}
@keyframes confetti-fall{
  0%{transform:translateY(0);}
  100%{transform:translateY(100vh);}
}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div class="stage">
  <div class="header">
    <div class="crown">ðŸ‘‘ <span id="best">0</span></div>
    <div class="score" id="score">0</div>
    <div style="width:36px"></div>
  </div>

  <div class="board-wrap">
    <div class="grid" id="grid"></div>
    <div class="controls">
      <div class="piece-slot" id="slot0"></div>
      <div class="piece-slot" id="slot1"></div>
      <div class="piece-slot" id="slot2"></div>
    </div>
    <div style="display:flex;justify-content:center;gap:8px;width:100%">
      <button class="btn" id="new">Nouvelle partie</button>
      <button class="btn" id="shuffle">Changer piÃ¨ces</button>
    </div>
  </div>

  <div class="secret" id="secret">
    <div class="secret-card"></div>
  </div>
</div>

<script>
// Background Particles
const canvas=document.getElementById("bg"),ctx=canvas.getContext("2d");
let W,H;
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();
const colors=['#39d353','#6ec7ff','#a06bff','#ff6b6b','#ffd54d'];
const particles=Array.from({length:100},()=>({x:Math.random()*W,y:Math.random()*H,r:Math.random()*3+2,dx:(Math.random()-0.5)*0.5,dy:(Math.random()-0.5)*0.5,color:colors[Math.floor(Math.random()*colors.length)],alpha:Math.random()*0.6+0.4}));
function draw(){ctx.clearRect(0,0,W,H);particles.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=p.color;ctx.globalAlpha=p.alpha;ctx.fill();ctx.globalAlpha=1;p.x+=p.dx;p.y+=p.dy;if(p.x<0||p.x>W)p.dx*=-1;if(p.y<0||p.y>H)p.dy*=-1;});requestAnimationFrame(draw);}
draw();
</script>

<script>
// Game Logic
const grid=document.getElementById("grid");
const slots=[document.getElementById("slot0"),document.getElementById("slot1"),document.getElementById("slot2")];
const scoreEl=document.getElementById("score"),bestEl=document.getElementById("best");
const secret=document.getElementById("secret"),closeSecret=document.getElementById("close-secret");
let board=[],score=0,best=0,currentPiece=null,scoreMultiplier=1;
const SECRET_SCORE=1000;
const secretMessage=`
ðŸ’– Djene ðŸ’–

Depuis la 6Ã¨me, le jour oÃ¹ nos regards se sont croisÃ©s pour la premiÃ¨re fois, mon cÅ“ur tâ€™avait dÃ©jÃ  choisie.

Jâ€™ai gardÃ© ce sentiment secret pendant des annÃ©es, jusquâ€™en 4Ã¨me-5Ã¨me, quand enfin nos cÅ“urs se sont rejoints.

Dans notre couple, il y a eu des moments magnifiques, des rires, des complicitÃ©s, mais aussi des pÃ©riodes difficiles.

Pourtant, mÃªme dans ces Ã©preuves, je nâ€™ai jamais cessÃ© de tâ€™aimer.

Devant Allah, jâ€™ai fait le serment de tâ€™Ã©pouser, et aprÃ¨s ce serment, jâ€™ai changÃ© pour devenir la meilleure version de moi-mÃªme, car ton amour mâ€™a transformÃ© positivement.

Mais avec le temps, nous avons commencÃ© Ã  avoir des disputes, des dÃ©saccords, jusquâ€™Ã  ce que nous soyons obligÃ©s de nous sÃ©parer.

MÃªme si nous nâ€™avions pas encore la mentalitÃ© pour tenir Ã  ce moment-lÃ , il y a une chose dont je suis certain : je finirai ma vie avec toi.

Djene, tu es et resteras celle qui a changÃ© ma vie, celle que jâ€™ai aimÃ©e depuis le premier regard, et celle avec qui je veux partager mon futur.

Peu importe les Ã©preuves, peu importe la distance ou le temps : mon amour pour toi est Ã©ternel, pur et sincÃ¨re.

ðŸ’– Je tâ€™aime, Djene, aujourdâ€™hui, demain et pour toujours. ðŸ’–
`;
const secretAudio=new Audio("sound/music.mp3"); secretAudio.preload="auto";

// Initialize
function init(){
  board=[]; grid.innerHTML="";
  for(let r=0;r<10;r++){const row=[];for(let c=0;c<10;c++){const cell=document.createElement("div");cell.className="cell";grid.appendChild(cell);row.push(null);}board.push(row);}
  score=0; scoreMultiplier=1; updateScore();
  genPieces();
}

// Shapes
const SHAPES=[[[1]],[[1,1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[1,1,0],[0,1,1]]];

// Generate Pieces
function genPieces(){
  slots.forEach(s=>s.innerHTML="");
  for(let i=0;i<3;i++){
    const shape=SHAPES[Math.floor(Math.random()*SHAPES.length)];
    const colorClass="c-"+(1+Math.floor(Math.random()*6));
    const piece=document.createElement("div"); piece.className="piece"; piece.style.gridTemplateColumns=`repeat(${shape[0].length},var(--tile-size))`;
    shape.forEach(row=>row.forEach(val=>{const t=document.createElement("div"); if(val){t.className="tile "+colorClass;} t.style.width="var(--tile-size)"; t.style.height="var(--tile-size)"; piece.appendChild(t);}));
    piece.draggable=true; piece.dataset.shape=JSON.stringify(shape); piece.dataset.color=colorClass;
    piece.addEventListener("dragstart",()=>{currentPiece={shape,color:colorClass,element:piece};});
    slots[i].appendChild(piece);
  }
}

// Drag & Drop & Preview
let previewCells=[];
grid.addEventListener("dragover",e=>e.preventDefault());
grid.addEventListener("drop",e=>{
  e.preventDefault(); if(!currentPiece) return;
  const rect=grid.getBoundingClientRect(),cellSize=rect.width/10;
  const x=Math.floor((e.clientX-rect.left)/cellSize),y=Math.floor((e.clientY-rect.top)/cellSize);
  placePiece(currentPiece.shape,currentPiece.color,x,y); currentPiece=null;
});
grid.addEventListener("mousemove", e=>{
  if(!currentPiece) return;
  const rect=grid.getBoundingClientRect(),cellSize=rect.width/10;
  const x=Math.floor((e.clientX-rect.left)/cellSize),y=Math.floor((e.clientY-rect.top)/cellSize);
  previewCells.forEach(c=>c.style.backgroundColor=''); previewCells=[];
  if(canPlace(currentPiece.shape,x,y)){
    currentPiece.shape.forEach((row,dy)=>row.forEach((val,dx)=>{
      if(val){const cell=grid.children[(y+dy)*10+(x+dx)]; cell.style.backgroundColor='rgba(255,255,255,0.2)'; previewCells.push(cell);}
    }));
  }
});
grid.addEventListener("mouseleave", ()=>{previewCells.forEach(c=>c.style.backgroundColor=''); previewCells=[];});

// Can Place
function canPlace(shape,x,y){
  for(let dy=0;dy<shape.length;dy++) for(let dx=0;dx<shape[0].length;dx++) if(shape[dy][dx]){if(y+dy>=10||x+dx>=10||board[y+dy][x+dx]) return false;}
  return true;
}

// Place Piece
function placePiece(shape,color,x,y){
  if(!canPlace(shape,x,y)) return;
  shape.forEach((row,dy)=>row.forEach((val,dx)=>{
    if(val){const cell=grid.children[(y+dy)*10+(x+dx)];const t=document.createElement("div");t.className="tile "+color;t.style.opacity=0;cell.appendChild(t);
    setTimeout(()=>{t.style.opacity=1; t.style.transform='scale(1.1)'; setTimeout(()=>t.style.transform='scale(1)',150);},50); board[y+dy][x+dx]=color;}
  }));
  if(score>=500 && scoreMultiplier===1) scoreMultiplier=1.05;
  score+=shape.flat().filter(v=>v).length*scoreMultiplier;
  updateScore();
  clearLines();
  if(score>=SECRET_SCORE) showSecret();
  genPieces();
}

// Clear Lines
function clearLines(){
  let cleared=false;
  for(let r=0;r<10;r++){if(board[r].every(c=>c)){board[r].fill(null);for(let c=0;c<10;c++) grid.children[r*10+c].innerHTML="";cleared=true;}}
  for(let c=0;c<10;c++){if(board.every(row=>row[c])){for(let r=0;r<10;r++){board[r][c]=null;grid.children[r*10+c].innerHTML="";}cleared=true;}}
  if(cleared){score+=10; updateScore();}
}

// Update Score
function updateScore(){scoreEl.textContent=Math.floor(score); scoreEl.classList.add('animate'); setTimeout(()=>scoreEl.classList.remove('animate'),200);}

// Show Secret with Confetti
function showSecret(){
  if(secret.classList.contains("show")) return;
  secret.classList.add("show");
  const card=secret.querySelector(".secret-card"); card.innerHTML='';
  const close=document.createElement("button"); close.className='btn'; close.textContent='Fermer'; close.onclick=()=>secret.classList.remove("show"); card.appendChild(close);
  secretMessage.split("\n\n").forEach(para=>{
    const p=document.createElement("p"); p.textContent=para; p.style.marginBottom="12px"; card.appendChild(p);
  });
  card.classList.add("show");
  secretAudio.currentTime=0; secretAudio.play().catch(()=>console.log("Interaction requise"));

  // Confetti
  for(let i=0;i<150;i++){
    const c=document.createElement("div"); c.className="confetti";
    c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
    c.style.left=Math.random()*window.innerWidth+"px";
    c.style.top=-10+"px";
    c.style.animationDuration=(2+Math.random()*2)+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),4000);
  }
}

// Buttons
document.getElementById("new").onclick=init;
document.getElementById("shuffle").onclick=genPieces;
closeSecret?.addEventListener("click",()=>secret.classList.remove("show"));

// Start Game
init();
// --- Test message secret avec touche P ---
window.addEventListener("keydown", (e) => {
  if (e.key.toLowerCase() === "p") {
    score = 1000;        // Force le score Ã  1000
    animateScore();      // Met Ã  jour l'affichage du score
    showSecret();        // Affiche le message secret
    console.log("Test : message secret dÃ©clenchÃ© !");
  }
});
</script>
</body>
</html>






