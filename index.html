<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Block Blast â€” Version Mobile Pro</title>
<style>
:root{
  --card-bg:#4b6bd6;
  --panel-bg:#2b3450;
  --accent:#ffd24d;
  --tile-size:36px;
}
*{box-sizing:border-box;font-family:Inter, 'Segoe UI', Roboto, Arial, sans-serif}
html,body{height:100%;margin:0;overflow:hidden;background:#000}

#bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;background:#000}

.stage{
  width:90%;max-width:420px;margin:28px auto;padding:18px;
  border-radius:36px;background:linear-gradient(180deg,var(--card-bg),#5977d6);
  color:#fff;position:relative;box-shadow:0 10px 30px rgba(0,0,0,.6);z-index:1;
}

.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.score{font-size:48px;font-weight:700;text-align:center;flex:1;transition:transform 0.2s;}
.score.animate{transform:scale(1.3);}
.crown{display:flex;align-items:center;gap:8px;color:var(--accent);font-weight:700}

.board-wrap{background:var(--panel-bg);padding:16px;border-radius:12px;display:flex;flex-direction:column;align-items:center}
.grid{width:100%;max-width:360px;aspect-ratio:1/1;background:rgba(0,0,0,0.15);
display:grid;grid-template-columns:repeat(10,1fr);grid-template-rows:repeat(10,1fr);gap:4px;padding:8px;border-radius:6px;position:relative;}
.cell{background:rgba(255,255,255,0.02);border-radius:4px;display:flex;align-items:center;justify-content:center;transition:background 0.2s;}
.cell.highlight-valid{background:rgba(57,211,83,0.5);}
.cell.highlight-invalid{background:rgba(255,107,107,0.5);}
.tile{width:100%;height:100%;border-radius:4px;box-shadow:inset -4px -4px 0 rgba(0,0,0,0.12);transition: transform 0.2s, opacity 0.2s;}

.controls{display:flex;justify-content:space-around;align-items:center;margin-top:18px;width:100%}
.piece-slot{width:30%;aspect-ratio:1.3/1;border-radius:12px;background:rgba(255,255,255,0.06);
display:flex;align-items:center;justify-content:center;padding:4px;position:relative;}
.piece{display:grid;gap:4px;cursor:grab;touch-action:none;user-select:none;transition:transform 0.2s;}
.piece.dragging{opacity:0.8;transform:scale(1.1);z-index:1000;}

.btn{margin-top:12px;padding:8px 12px;border-radius:12px;background:rgba(0,0,0,0.2);border:0;color:#fff;cursor:pointer;flex:1;transition:background 0.2s;}
.btn:hover{background:rgba(0,0,0,0.35);}

.c-1{background:#ffd54d}
.c-2{background:#39d353}
.c-3{background:#6ec7ff}
.c-4{background:#a06bff}
.c-5{background:#ff6b6b}
.c-6{background:#3b82f6}

.secret{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,0.25),rgba(0,0,0,0.6));
backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:all .28s ease;}
.secret.show{opacity:1;pointer-events:auto}
.secret-card{background:#fff;color:#111;padding:28px;border-radius:18px;max-width:320px;text-align:center;box-shadow:0 20px 40px rgba(0,0,0,0.35);}
.secret-card h2{margin:0 0 8px;font-size:22px;}
.secret-card p{margin:0 0 14px;}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div class="stage">
  <div class="header">
    <div class="crown">ðŸ‘‘ <span id="best">0</span></div>
    <div class="score" id="score">0</div>
    <div style="width:36px"></div>
  </div>

  <div class="board-wrap">
    <div class="grid" id="grid" aria-label="Grille de jeu"></div>
    <div class="controls">
      <div class="piece-slot" id="slot0"></div>
      <div class="piece-slot" id="slot1"></div>
      <div class="piece-slot" id="slot2"></div>
    </div>
    <div style="display:flex;justify-content:center;gap:8px;width:100%">
      <button class="btn" id="new">Nouvelle partie</button>
      <button class="btn" id="shuffle">Changer piÃ¨ces</button>
    </div>
  </div>

  <div class="secret" id="secret">
    <div class="secret-card">
      <h2>FÃ©licitations ! ðŸŽ‰</h2>
      <p>Tu as dÃ©couvert le message secret âœ¨</p>
      <p id="secret-text" style="font-weight:700">Message cachÃ© : <span>Â« Bravo, dÃ©veloppeur curieux Â»</span></p>
      <button class="btn" id="close-secret">Fermer</button>
    </div>
  </div>
</div>

<script>
// === Fond animÃ© ===
const canvas=document.getElementById("bg");
const ctx=canvas.getContext("2d");
let W,H;
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();
const colors=['#39d353','#6ec7ff','#a06bff','#ff6b6b','#ffd54d'];
const particles=Array.from({length:80},()=>({x:Math.random()*W,y:Math.random()*H,r:Math.random()*3+2,dx:(Math.random()-0.5)*0.5,dy:(Math.random()-0.5)*0.5,color:colors[Math.floor(Math.random()*colors.length)],alpha:Math.random()*0.6+0.4}));
function draw(){ctx.clearRect(0,0,W,H);particles.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=p.color;ctx.globalAlpha=p.alpha;ctx.fill();ctx.globalAlpha=1;p.x+=p.dx;p.y+=p.dy;if(p.x<0||p.x>W)p.dx*=-1;if(p.y<0||p.y>H)p.dy*=-1;});requestAnimationFrame(draw);}
draw();
</script>

<script>
const grid=document.getElementById("grid");
const slots=[document.getElementById("slot0"),document.getElementById("slot1"),document.getElementById("slot2")];
const scoreEl=document.getElementById("score");
const bestEl=document.getElementById("best");
const secret=document.getElementById("secret");
const closeSecret=document.getElementById("close-secret");
const SECRET_SCORE=500;

let board=[],score=0,best=0,currentPiece=null,ghostTiles=[];

const SHAPES=[[[1]],[[1,1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[1,1,0],[0,1,1]]];

function init(){
  board=[];grid.innerHTML="";
  for(let r=0;r<10;r++){
    const row=[];
    for(let c=0;c<10;c++){
      const cell=document.createElement("div");
      cell.className="cell";
      grid.appendChild(cell);
      row.push(null);
    }
    board.push(row);
  }
  score=0;scoreEl.textContent=0;
  genPieces();
}

function genPieces(){
  slots.forEach(s=>s.innerHTML="");
  for(let i=0;i<3;i++){
    const shape=SHAPES[Math.floor(Math.random()*SHAPES.length)];
    const colorClass="c-"+(1+Math.floor(Math.random()*6));
    const piece=document.createElement("div");
    piece.className="piece";
    piece.style.gridTemplateColumns=`repeat(${shape[0].length},var(--tile-size))`;
    shape.forEach(row=>{
      row.forEach(val=>{
        const t=document.createElement("div");
        t.style.width=t.style.height="var(--tile-size)";
        if(val){t.className="tile "+colorClass}
        piece.appendChild(t);
      });
    });
    piece.dataset.shape=JSON.stringify(shape);
    piece.dataset.color=colorClass;
    piece.addEventListener("pointerdown",startDrag);
    slots[i].appendChild(piece);
  }
}

// --- Drag & drop + Ghost ---
function startDrag(e){
  e.preventDefault();
  const piece=this;
  currentPiece={shape:JSON.parse(piece.dataset.shape),color:piece.dataset.color,element:piece};
  piece.classList.add("dragging");

  function moveDrag(ev){
    ev.preventDefault();
    const x=ev.clientX||ev.touches[0].clientX;
    const y=ev.clientY||ev.touches[0].clientY;
    piece.style.position="fixed";
    piece.style.left=x-piece.offsetWidth/2+"px";
    piece.style.top=y-piece.offsetHeight/2+"px";

    updateGhost(x,y);
  }

  function endDrag(ev){
    piece.classList.remove("dragging");
    piece.style.position="";piece.style.left="";piece.style.top="";
    clearGhost();

    const rect=grid.getBoundingClientRect();
    const x=Math.floor(((ev.clientX||ev.changedTouches[0].clientX)-rect.left)/(rect.width/10));
    const y=Math.floor(((ev.clientY||ev.changedTouches[0].clientY)-rect.top)/(rect.height/10));
    placePiece(currentPiece.shape,currentPiece.color,x,y);
    currentPiece=null;

    window.removeEventListener("pointermove",moveDrag);
    window.removeEventListener("pointerup",endDrag);
    window.removeEventListener("touchmove",moveDrag);
    window.removeEventListener("touchend",endDrag);
  }

  window.addEventListener("pointermove",moveDrag);
  window.addEventListener("pointerup",endDrag);
  window.addEventListener("touchmove",moveDrag,{passive:false});
  window.addEventListener("touchend",endDrag);
}

function updateGhost(x,y){
  clearGhost();
  const rect=grid.getBoundingClientRect();
  const gx=Math.floor((x-rect.left)/(rect.width/10));
  const gy=Math.floor((y-rect.top)/(rect.height/10));
  const valid=canPlace(currentPiece.shape,gx,gy);
  currentPiece.shape.forEach((row,dy)=>{
    row.forEach((val,dx)=>{
      if(val){
        const cx=gx+dx,cy=gy+dy;
        if(cx<10 && cy<10){
          const cell=grid.children[cy*10+cx];
          cell.classList.add(valid?"highlight-valid":"highlight-invalid");
          ghostTiles.push(cell);
        }
      }
    });
  });
}

function clearGhost(){ghostTiles.forEach(c=>c.classList.remove("highlight-valid","highlight-invalid"));ghostTiles=[];}

function placePiece(shape,color,x,y){
  if(!canPlace(shape,x,y)) return;
  shape.forEach((row,dy)=>{
    row.forEach((val,dx)=>{
      if(val){
        const cell=grid.children[(y+dy)*10+(x+dx)];
        const t=document.createElement("div");
        t.className="tile "+color;
        t.style.opacity=0;
        cell.appendChild(t);
        setTimeout(()=>t.style.opacity=1,50);
        board[y+dy][x+dx]=color;
      }
    });
  });
  score+=shape.flat().filter(v=>v).length;
  animateScore();
  if(score>best){best=score;bestEl.textContent=best;}
  clearLines();
  if(score>=SECRET_SCORE){secret.classList.add("show");}
  genPieces();
}

function animateScore(){scoreEl.classList.add("animate");setTimeout(()=>scoreEl.classList.remove("animate"),200);scoreEl.textContent=score;}

function canPlace(shape,x,y){
  for(let dy=0;dy<shape.length;dy++){
    for(let dx=0;dx<shape[0].length;dx++){
      if(shape[dy][dx]){
        if(y+dy>=10||x+dx>=10||board[y+dy][x+dx]) return false;
      }
    }
  }
  return true;
}

function clearLines(){
  let cleared=false;
  for(let r=0;r<10;r++){
    if(board[r].every(cell=>cell)){
      board[r].fill(null);
      for(let c=0;c<10;c++){
        const cell=grid.children[r*10+c];
        cell.innerHTML="";
        cell.style.transform="scale(0)";
        setTimeout(()=>cell.style.transform="scale(1)",100);
      }
      cleared=true;
    }
  }
  for(let c=0;c<10;c++){
    if(board.every(row=>row[c])){
      for(let r=0;r<10;r++){
        board[r][c]=null;
        const cell=grid.children[r*10+c];
        cell.innerHTML="";
        cell.style.transform="scale(0)";
        setTimeout(()=>cell.style.transform="scale(1)",100);
      }
      cleared=true;
    }
  }
  if(cleared){score+=10;animateScore();}
}

document.getElementById("new").onclick=init;
document.getElementById("shuffle").onclick=genPieces;
closeSecret.onclick=()=>secret.classList.remove("show");

init();
</script>
</body>
</html>

